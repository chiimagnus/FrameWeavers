# ğŸ¬ å¸§ç»‡è€…APIæ–‡æ¡£

## ğŸ¯ æ ¸å¿ƒåŠŸèƒ½æ¦‚è§ˆ

å¸§ç»‡è€…ç³»ç»Ÿæ˜¯ä¸€ä¸ªè§†é¢‘è½¬è¿ç¯ç”»çš„æ™ºèƒ½å¤„ç†å¹³å°ï¼Œæä¾›å®Œæ•´çš„**è§†é¢‘â†’åŸºç¡€å¸§â†’å…³é”®å¸§â†’æ•…äº‹â†’è¿ç¯ç”»**çš„å¤„ç†æµç¨‹ã€‚

### ğŸš€ ä¸‰å¤§æ ¸å¿ƒAPIï¼ˆé‡ç‚¹æ¨èï¼‰

| åºå· | APIåç§° | æ¥å£åœ°å€ | åŠŸèƒ½æè¿° | æ¨èæŒ‡æ•° |
|------|---------|----------|----------|----------|
| 1ï¸âƒ£ | **è§†é¢‘ä¸Šä¼ æ¥å£** | `/api/upload/videos` | ä¸Šä¼ è§†é¢‘æ–‡ä»¶ï¼Œè·å–ä»»åŠ¡ID | â­â­â­â­â­ |
| 2ï¸âƒ£ | **åŸºç¡€å¸§æå–æ¥å£** | `/api/extract/base-frames` | ä»è§†é¢‘ä¸­æŒ‰æ—¶é—´é—´éš”æå–åŸºç¡€å¸§ | â­â­â­â­â­ |
| 3ï¸âƒ£ | **å®Œæ•´è¿ç¯ç”»ç”ŸæˆAPI** | `/api/process/complete-comic` | ä¸€é”®ç”Ÿæˆå®Œæ•´è¿ç¯ç”»ï¼ˆå…³é”®å¸§+æ•…äº‹+é£æ ¼åŒ–ï¼‰ | â­â­â­â­â­ |

### ğŸ’¡ å…¸å‹ä½¿ç”¨æµç¨‹

```mermaid
graph LR
    A[ä¸Šä¼ è§†é¢‘] --> B[æå–åŸºç¡€å¸§] --> C[ç”Ÿæˆå®Œæ•´è¿ç¯ç”»]
    C --> D[è·å–è¿ç¯ç”»ç»“æœ]
```

## ğŸ”§ åŸºç¡€ä¿¡æ¯

- **æœåŠ¡åœ°å€**: `http://æœåŠ¡å™¨åœ°å€:5001`
- **å“åº”æ ¼å¼**: JSON
- **æ”¯æŒæ ¼å¼**: mp4, mov, avi, mkv, wmv, flv, 3gp
- **æ–‡ä»¶é™åˆ¶**: æœ€å¤§800MB
- **çŠ¶æ€ç **:
  - `200` æˆåŠŸ
  - `400` å‚æ•°é”™è¯¯
  - `404` èµ„æºä¸å­˜åœ¨
  - `413` æ–‡ä»¶è¿‡å¤§
  - `500` æœåŠ¡å™¨é”™è¯¯

## 1ï¸âƒ£ æ ¸å¿ƒAPIï¼šè§†é¢‘ä¸Šä¼ æ¥å£

### æ¥å£ä¿¡æ¯
- **è·¯å¾„**: `/api/upload/videos`
- **æ–¹æ³•**: `POST`
- **æ ¼å¼**: `multipart/form-data`
- **ä½œç”¨**: ä¸Šä¼ è§†é¢‘æ–‡ä»¶ï¼Œå¼€å§‹å¤„ç†æµç¨‹

### è¯·æ±‚å‚æ•°

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| `device_id` | string | âœ… | è®¾å¤‡å”¯ä¸€æ ‡è¯† |
| `videos` | file[] | âœ… | è§†é¢‘æ–‡ä»¶ï¼ˆæ”¯æŒå¤šæ–‡ä»¶ï¼‰ |

### è¯·æ±‚ç¤ºä¾‹

```bash
curl -X POST "http://localhost:5001/api/upload/videos" \
  -F "device_id=web_client_001" \
  -F "videos=@æµ‹è¯•è§†é¢‘.mp4"
```

### å“åº”ç¤ºä¾‹

```json
{
  "success": true,
  "message": "è§†é¢‘ä¸Šä¼ æˆåŠŸ",
  "task_id": "550e8400-e29b-41d4-a716-446655440000",
  "device_id": "web_client_001",
  "uploaded_files": 1,
  "invalid_files": null
}
```

### ğŸ¯ å…³é”®ä¿¡æ¯
- **ğŸ“ è®°ä½**: è¿”å›çš„`task_id`æ˜¯åç»­æ‰€æœ‰APIè°ƒç”¨çš„æ ¸å¿ƒå‚æ•°
- **âš ï¸ æ³¨æ„**: æ–‡ä»¶å¿…é¡»å°äº800MB
- **ğŸ’¡ æç¤º**: æ”¯æŒåŒæ—¶ä¸Šä¼ å¤šä¸ªè§†é¢‘æ–‡ä»¶

---

## 2ï¸âƒ£ æ ¸å¿ƒAPIï¼šåŸºç¡€å¸§æå–æ¥å£

### æ¥å£ä¿¡æ¯
- **è·¯å¾„**: `/api/extract/base-frames`
- **æ–¹æ³•**: `POST`
- **æ ¼å¼**: `application/x-www-form-urlencoded`
- **ä½œç”¨**: ä»è§†é¢‘ä¸­æŒ‰æ—¶é—´é—´éš”æå–åŸºç¡€å¸§å›¾åƒ

### è¯·æ±‚å‚æ•°

| å‚æ•°å | ç±»å‹ | å¿…å¡« | é»˜è®¤å€¼ | è¯´æ˜ |
|--------|------|------|--------|------|
| `task_id` | string | âœ… | - | è§†é¢‘ä¸Šä¼ åè·å¾—çš„ä»»åŠ¡ID |
| `interval` | float | âŒ | 1.0 | æŠ½å¸§æ—¶é—´é—´éš”ï¼ˆç§’ï¼‰ |

### è¯·æ±‚ç¤ºä¾‹

```bash
curl -X POST "http://localhost:5001/api/extract/base-frames" \
  -d "task_id=550e8400-e29b-41d4-a716-446655440000" \
  -d "interval=1.0"
```

### å“åº”ç¤ºä¾‹

```json
{
  "success": true,
  "message": "åŸºç¡€å¸§æå–æˆåŠŸ",
  "task_id": "550e8400-e29b-41d4-a716-446655440000",
  "results": [
    {
      "video_name": "æµ‹è¯•è§†é¢‘.mp4",
      "base_frames_count": 48,
      "base_frames_paths": [
        "frames/test_task_123/base_frame_0000.jpg",
        "frames/test_task_123/base_frame_0001.jpg",
        "..."
      ],
      "output_dir": "frames/test_task_123"
    }
  ]
}
```

### ğŸ¯ å…³é”®ä¿¡æ¯
- **ğŸ“Š æ•°é‡**: é€šå¸¸ä¼šç”Ÿæˆå‡ åå¼ åŸºç¡€å¸§
- **ğŸ•’ é—´éš”**: å»ºè®®é—´éš”0.5-2.0ç§’ï¼Œå¤ªå°ä¼šäº§ç”Ÿè¿‡å¤šå¸§
- **ğŸ“ å­˜å‚¨**: åŸºç¡€å¸§ä¿å­˜åœ¨`frames/{task_id}/`ç›®å½•ä¸‹

---

## 3ï¸âƒ£ æ ¸å¿ƒAPIï¼šå®Œæ•´è¿ç¯ç”»ç”Ÿæˆæ¥å£

### æ¥å£ä¿¡æ¯
- **è·¯å¾„**: `/api/process/complete-comic`
- **æ–¹æ³•**: `POST`
- **æ ¼å¼**: `application/x-www-form-urlencoded`
- **ä½œç”¨**: ğŸŒŸ ä¸€é”®å®Œæˆå…³é”®å¸§æå–ã€æ•…äº‹ç”Ÿæˆã€é£æ ¼åŒ–å¤„ç†çš„å®Œæ•´æµç¨‹

### å¤„ç†æµç¨‹

```mermaid
graph TD
    A[åŸºç¡€å¸§] --> B[æ™ºèƒ½æå–å…³é”®å¸§]
    B --> C[ç”Ÿæˆæ•…äº‹æ–‡æœ¬]
    C --> D[é£æ ¼åŒ–å¤„ç†]
    D --> E[å®Œæ•´è¿ç¯ç”»]
```

### è¯·æ±‚å‚æ•°

| å‚æ•°å | ç±»å‹ | å¿…å¡« | é»˜è®¤å€¼ | è¯´æ˜ |
|--------|------|------|--------|------|
| `task_id` | string | âœ… | - | ä»»åŠ¡ID |
| `target_frames` | int | âŒ | 8 | ç›®æ ‡å…³é”®å¸§æ•°é‡ |
| `frame_interval` | float | âŒ | 1.0 | åŸºç¡€å¸§æå–é—´éš” |
| `significance_weight` | float | âŒ | 0.6 | é‡è¦æ€§æƒé‡(0-1) |
| `quality_weight` | float | âŒ | 0.4 | è´¨é‡æƒé‡(0-1) |
| `style_prompt` | string | âŒ | é»˜è®¤æ°´å¢¨ç”» | é£æ ¼åŒ–æç¤ºè¯ |
| `image_size` | string | âŒ | 1920x1024 | è¾“å‡ºå›¾åƒå°ºå¯¸ |
| `story_style` | string | âŒ | é€šç”¨ | æ•…äº‹æ–‡ä½“é£æ ¼ |
| `max_concurrent` | int | âŒ | 50 | æœ€å¤§å¹¶å‘æ•° |

### è¯·æ±‚ç¤ºä¾‹

```bash
curl -X POST "http://localhost:5001/api/process/complete-comic" \
  -d "task_id=550e8400-e29b-41d4-a716-446655440000" \
  -d "target_frames=8" \
  -d "style_prompt=æ‰‹ç»˜æ¼«ç”»é£æ ¼ï¼Œæ¸©æš–è‰²è°ƒ" \
  -d "story_style=ç«¥è¯é£æ ¼"
```

### å“åº”ç¤ºä¾‹ï¼ˆå¯åŠ¨ï¼‰

```json
{
  "success": true,
  "message": "å®Œæ•´è¿ç¯ç”»ç”Ÿæˆå·²å¯åŠ¨",
  "task_id": "550e8400-e29b-41d4-a716-446655440000",
  "status": "complete_comic_processing",
  "progress": 0,
  "stage": "initializing"
}
```

### ğŸ¯ å…³é”®ä¿¡æ¯
- **â±ï¸ æ—¶é—´**: æ•´ä¸ªå¤„ç†éœ€è¦2-5åˆ†é’Ÿï¼Œè¯·è€å¿ƒç­‰å¾…
- **ğŸ“ˆ è¿›åº¦**: å¯é€šè¿‡ä»»åŠ¡çŠ¶æ€æ¥å£æŸ¥çœ‹å®æ—¶è¿›åº¦
- **ğŸ¨ é£æ ¼**: æ”¯æŒè‡ªå®šä¹‰é£æ ¼æç¤ºè¯
- **ğŸ“š æ•…äº‹**: æ”¯æŒå¤šç§æ–‡ä½“é£æ ¼ï¼ˆå¤å…¸ã€ç°ä»£ã€ç«¥è¯ç­‰ï¼‰

## ğŸ“Š ä»»åŠ¡çŠ¶æ€æŸ¥è¯¢æ¥å£

### æ¥å£ä¿¡æ¯
- **è·¯å¾„**: `/api/task/status/<task_id>`
- **æ–¹æ³•**: `GET`
- **ä½œç”¨**: æŸ¥è¯¢ä»»åŠ¡å¤„ç†è¿›åº¦å’ŒçŠ¶æ€

### è¯·æ±‚ç¤ºä¾‹

```bash
curl -X GET "http://localhost:5001/api/task/status/550e8400-e29b-41d4-a716-446655440000"
```

### å“åº”ç¤ºä¾‹

```json
{
  "success": true,
  "task_id": "550e8400-e29b-41d4-a716-446655440000",
  "status": "complete_comic_processing",
  "message": "æ­£åœ¨ç”Ÿæˆæ•…äº‹... (1/1)",
  "progress": 45,
  "stage": "generating_story",
  "device_id": "web_client_001",
  "created_at": "2023-10-15T14:30:15.123456"
}
```

### ä»»åŠ¡çŠ¶æ€è¯´æ˜

| çŠ¶æ€å€¼ | é˜¶æ®µ | è¿›åº¦ | è¯´æ˜ |
|--------|------|------|------|
| `uploaded` | ä¸Šä¼ å®Œæˆ | 0% | è§†é¢‘å·²ä¸Šä¼ ï¼Œç­‰å¾…å¤„ç† |
| `extracting_base_frames` | åŸºç¡€å¸§æå– | 10-20% | æ­£åœ¨æå–åŸºç¡€å¸§ |
| `base_frames_extracted` | åŸºç¡€å¸§å®Œæˆ | 20% | åŸºç¡€å¸§æå–å®Œæˆ |
| `complete_comic_processing` | è¿ç¯ç”»ç”Ÿæˆä¸­ | 20-90% | æ­£åœ¨ç”Ÿæˆå®Œæ•´è¿ç¯ç”» |
| `extracting_keyframes` | å…³é”®å¸§æå– | 20-40% | æ­£åœ¨æ™ºèƒ½æå–å…³é”®å¸§ |
| `generating_story` | æ•…äº‹ç”Ÿæˆ | 40-70% | æ­£åœ¨ç”Ÿæˆæ•…äº‹æ–‡æœ¬ |
| `stylizing_frames` | é£æ ¼åŒ–å¤„ç† | 70-90% | æ­£åœ¨è¿›è¡Œé£æ ¼åŒ–å¤„ç† |
| `complete_comic_completed` | å®Œæˆ | 100% | è¿ç¯ç”»ç”Ÿæˆå®Œæˆ |
| `error` | é”™è¯¯ | - | å¤„ç†å‡ºé”™ |

## ğŸ“– è·å–è¿ç¯ç”»ç»“æœæ¥å£

### æ¥å£ä¿¡æ¯
- **è·¯å¾„**: `/api/comic/result/<task_id>`
- **æ–¹æ³•**: `GET`
- **ä½œç”¨**: è·å–å®Œæ•´è¿ç¯ç”»ç”Ÿæˆç»“æœ

### è¯·æ±‚ç¤ºä¾‹

```bash
curl -X GET "http://localhost:5001/api/comic/result/550e8400-e29b-41d4-a716-446655440000"
```

### å“åº”ç¤ºä¾‹ï¼ˆå®Œæˆï¼‰

```json
{
  "success": true,
  "message": "è¿ç¯ç”»ç”Ÿæˆå®Œæˆ",
  "task_id": "550e8400-e29b-41d4-a716-446655440000",
  "results": {
    "successful_comics": [
      {
        "video_name": "æµ‹è¯•è§†é¢‘.mp4",
        "success": true,
        "comic_data": {
          "story_info": {
            "overall_theme": "ä¸€æ®µå…³äºå‹‡æ°”ä¸æˆé•¿çš„å†’é™©ä¹‹æ—…",
            "title": "å‹‡æ°”ä¸æˆé•¿",
            "summary": "å¹´è½»æ¢é™©è€…çš„å¿ƒçµæˆé•¿å†ç¨‹",
            "total_pages": 8,
            "video_name": "æµ‹è¯•è§†é¢‘.mp4",
            "creation_time": "2024-01-15 14:30:00"
          },
          "pages": [
            {
              "page_index": 0,
              "story_text": "é˜³å…‰é€è¿‡æ ‘å¶ï¼Œæ´’åœ¨å¹´è½»æ¢é™©è€…çš„è„¸ä¸Šï¼Œæ–°çš„å†’é™©å³å°†å¼€å§‹...",
              "original_frame_path": "frames/task_123/unified_key_00.jpg",
              "styled_frame_path": "frames/task_123/styled/styled_unified_key_00.jpg",
              "styled_filename": "styled_unified_key_00.jpg",
              "frame_index": 0,
              "style_applied": true
            }
          ],
          "interactive_questions": [
            {
              "question_id": 1,
              "question": "ä½ è§‰å¾—ä¸»äººå…¬ç°åœ¨çš„å¿ƒæƒ…å¦‚ä½•ï¼Ÿ",
              "options": ["å…´å¥‹æœŸå¾…", "ç´§å¼ ä¸å®‰", "å……æ»¡å¥½å¥‡", "æœ‰äº›å®³æ€•"],
              "scene_description": "ä¸»äººå…¬ç«™åœ¨å†’é™©çš„èµ·ç‚¹",
              "question_type": "æƒ…æ„Ÿç†è§£"
            }
          ]
        }
      }
    ],
    "total_processed": 1,
    "success_count": 1,
    "failure_count": 0
  }
}
```

## ğŸ¨ å…¶ä»–è¾…åŠ©æ¥å£

### å…³é”®å¸§æå–æ¥å£
- **è·¯å¾„**: `/api/extract/key-frames`
- **ä½œç”¨**: å•ç‹¬æå–å…³é”®å¸§ï¼ˆä¸åŒ…å«æ•…äº‹ç”Ÿæˆï¼‰

### æ•…äº‹ç”Ÿæˆæ¥å£
- **è·¯å¾„**: `/api/generate/story`
- **ä½œç”¨**: ä¸ºå…³é”®å¸§ç”Ÿæˆæ•…äº‹æ–‡æœ¬

### é£æ ¼åŒ–å¤„ç†æ¥å£
- **è·¯å¾„**: `/api/process/style-transform`
- **ä½œç”¨**: å¯¹å…³é”®å¸§è¿›è¡Œé£æ ¼åŒ–å¤„ç†

### æ–‡ä»¶è·å–æ¥å£
- **è·¯å¾„**: `/api/frames/<task_id>/<filename>`
- **ä½œç”¨**: è·å–æŒ‡å®šçš„å¸§å›¾åƒæ–‡ä»¶

### è®¾å¤‡ä»»åŠ¡å†å²
- **è·¯å¾„**: `/api/device/<device_id>/tasks`
- **ä½œç”¨**: æŸ¥çœ‹è®¾å¤‡çš„æ‰€æœ‰ä»»åŠ¡è®°å½•

## ğŸš¨ é”™è¯¯å¤„ç†

### å¸¸è§é”™è¯¯ç±»å‹

| é”™è¯¯ç  | é”™è¯¯ç±»å‹ | è§£å†³æ–¹æ¡ˆ |
|--------|----------|----------|
| 400 | å‚æ•°é”™è¯¯ | æ£€æŸ¥å¿…å¡«å‚æ•°æ˜¯å¦å®Œæ•´ |
| 404 | ä»»åŠ¡ä¸å­˜åœ¨ | ç¡®è®¤task_idæ˜¯å¦æ­£ç¡® |
| 413 | æ–‡ä»¶è¿‡å¤§ | å‹ç¼©è§†é¢‘æˆ–åˆ†æ®µä¸Šä¼  |
| 500 | æœåŠ¡å™¨é”™è¯¯ | é‡è¯•æˆ–è”ç³»æŠ€æœ¯æ”¯æŒ |

### é”™è¯¯å“åº”ç¤ºä¾‹

```json
{
  "success": false,
  "message": "æ–‡ä»¶è¿‡å¤§ï¼Œè¯·é€‰æ‹©å°äº800MBçš„è§†é¢‘æ–‡ä»¶"
}
```
